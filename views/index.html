<link rel="stylesheet" href="/css/index.css" />
<script type="text/javascript">
    window.onload = () => {
        let createRoomBtn = document.getElementById("create");
        let roomNameInput = document.getElementById("roomName");
        let userNameInput = document.getElementById("userName");
        createRoomBtn.onclick = (e) => {
            if (roomNameInput.value.trim() === '' || userNameInput.value.trim() === '') {
                alert(`名字不能为空！！`);
                return false;
            }
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = () => {
                if (xmlhttp.readyState == XMLHttpRequest.DONE) {
                    if (xmlhttp.status < 300) {
                        let resp = JSON.parse(xmlhttp.responseText);
                        if (resp.code == 0) {
                            window.location = `/rooms/${resp.roomId}`;
                        } else {
                            alert(resp.msg);
                        }
                    } else {
                        alert('something else other than 200 was returned');
                    }
                }
            };

            xmlhttp.open("POST", "/rooms/", true);
            xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            xmlhttp.send(JSON.stringify({
                "roomNname": roomNameInput.value,
                "userName": userNameInput.value
            }));
        }
    }

</script>

<div class="container">
    <div class="form">
        <p><input id="roomName" type="text" placeholder="请输入房间名..."></input>
        </p>
        <p><input id="userName" type="text" placeholder="请输入用户名..."></input>
        </p>
        <div class="btn-tools">
            <input id="create" type="button" value="创建新房间">
        </div>
    </div>


    <%
        if(rooms.length > 0) {
    %>
    <hr>
        <ul id="createdRooms" aria-label="已有房间">
        <%            
            for(let room of rooms) { 
        %>
            <li>
                <a href="/rooms/<%= room.id %>">
                    <%= room.name%> 
                </a>created by <%= room.createBy %>
            </li>
        <%
            }
        }
        %>

        </ul>
</div>